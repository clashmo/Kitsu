# Фронтенд (Next.js)

## Назначение

Пользовательский веб-интерфейс для каталога аниме и воспроизведения через HLS-прокси. Получает данные из FastAPI-бэкенда; без доступного API интерфейс работает некорректно.

## Технологии

- Next.js 15 (app router), React 18
- Tailwind CSS, shadcn/ui
- React Query, Axios, zustand
- next-runtime-env для прокидывания переменных окружения в рантайме
- ArtPlayer + HLS.js для плеера

## Обязательные переменные окружения

- `NEXT_PUBLIC_API_URL` — публичный URL FastAPI (например, `http://localhost:8000`).
- `NEXT_PUBLIC_PROXY_URL` — URL HLS/m3u8-прокси для выдачи потоков (например, `http://localhost:4040`).

Укажите их в `.env.local` для локальной работы или в переменных окружения Render. При отсутствии `NEXT_PUBLIC_API_URL` запросы к API не выполняются.

## Локальный запуск

```bash
npm install
NEXT_PUBLIC_API_URL=http://localhost:8000 \
NEXT_PUBLIC_PROXY_URL=http://localhost:4040 \
npm run dev
```

Фронтенд требует доступного бэкенда по `NEXT_PUBLIC_API_URL` и прокси по `NEXT_PUBLIC_PROXY_URL`.

## Продакшн/Render

1. Соберите образ с помощью корневого `Dockerfile` (Next.js standalone).
2. Настройте `NEXT_PUBLIC_API_URL` (публичный адрес бэкенда) и `NEXT_PUBLIC_PROXY_URL` (публичный адрес HLS-прокси) в настройках Render.
3. Разверните контейнер, откройте порт 3000.
4. Убедитесь, что бэкенд доступен с фронтенда; иначе страницы каталога и просмотр не работают.

## Зависимость от бэкенда

- Все данные каталога, поиска и авторизации приходят из FastAPI.
- При недоступности API страницы `/anime` и `/search/anime` отображают пустые/ошибочные состояния.

## Гибридные источники данных

- Часть маршрутов воспроизведения и поиска использует скрейперы HiAnime через API-роуты Next.js.
- FastAPI остаётся источником истины для основного каталога; скрейперы вспомогательные и могут отличаться по структуре данных.

## Ограничения текущего MVP

- UI авторизации неполный: не все потоки login/refresh выведены в интерфейс.
- Для некоторых аниме используются заглушки постеров/эпизодов, если бэкенд не возвращает данные.
- Работа с ошибками минимальна: при падении бэкенда блоки страниц отображают пустые результаты без подробных сообщений.
- Отсутствует изоляция от недоступности `NEXT_PUBLIC_PROXY_URL`: без прокси воспроизведение не работает.
